<h3>Inspection Dashboard</h3>

<!-- Filters -->
<div class="row mt-3">

    <!-- Product Filter -->
    <div class="col-md-4">
        <select class="form-select" [(ngModel)]="productId" (change)="loadSummary()">
            <option value="">All Products</option>
            <option *ngFor="let p of products" [value]="p._id">{{p.name}}</option>
        </select>
    </div>

    <!-- Stage Filter -->
    <div class="col-md-4">
        <select class="form-select" [(ngModel)]="stage" (change)="loadSummary()">
            <option value="">All Stages</option>
            <option value="in-process">In-Process</option>
            <option value="final">Final</option>
        </select>
    </div>

</div>
<div class="row mt-4">

    <!-- Products -->
    <div class="col-md-3">
        <div class="card shadow-sm p-3 text-center">
            <h5>Products</h5>
            <h2>{{counts.products}}</h2>
        </div>
    </div>

    <!-- Parameters -->
    <div class="col-md-3">
        <div class="card shadow-sm p-3 text-center">
            <h5>Parameters</h5>
            <h2>{{counts.parameters}}</h2>
        </div>
    </div>

    <!-- Specs -->
    <div class="col-md-3">
        <div class="card shadow-sm p-3 text-center">
            <h5>Specifications</h5>
            <h2>{{counts.specs}}</h2>
        </div>
    </div>

    <!-- Reports -->
    <div class="col-md-3">
        <div class="card shadow-sm p-3 text-center">
            <h5>Reports</h5>
            <h2>{{counts.reports}}</h2>
        </div>
    </div>

</div>
<!-- Summary Cards -->
<div class="row mt-4">

    <div class="col-md-4">
        <div class="card p-3 shadow-sm text-center">
            <h5>Total Reports</h5>
            <h2>{{summary.totalReports}}</h2>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card p-3 shadow-sm text-center">
            <h5>Total OK</h5>
            <h2 class="text-success">{{summary.totalOk}}</h2>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card p-3 shadow-sm text-center">
            <h5>Total NOT OK</h5>
            <h2 class="text-danger">{{summary.totalNotOk}}</h2>
        </div>
    </div>

</div>

<!-- Recent Reports Table -->
<h4 class="mt-4">Filtered Inspection Reports</h4>

<table class="table table-bordered mt-2">
    <thead>
        <tr>
            <th>Product</th>
            <th>Stage</th>
            <th>Inspector</th>
            <th>Date</th>
            <th>OK / NOT OK</th>
        </tr>
    </thead>

    <tbody>
        <tr *ngFor="let r of summary.reports">
            <td>{{r?.productId?.name}}</td>
            <td>{{r?.stage}}</td>
            <td>{{r?.inspectedBy}}</td>
            <td>{{r?.createdAt | date:'short'}}</td>
            <td>
                <span class="text-success fw-bold">
                    {{ getOkCount(r) }}
                </span>
                /
                <span class="text-danger fw-bold">
                    {{getNotOkCount(r)}}
                </span>
            </td>
        </tr>
    </tbody>
</table>