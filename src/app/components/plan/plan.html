<h3>Inspection Plan</h3>

<form #planForm="ngForm" (ngSubmit)="addPlan(planForm)" novalidate>
    <div class="row mt-3">
        <div class="col">
            <select class="form-select" name="productId" required [(ngModel)]="productId" (change)="loadPlans()"
                #prodRef="ngModel" [ngClass]="{'is-invalid': prodRef.invalid && prodRef.touched}">
                <option value="">Select Product</option>
                <option *ngFor="let p of products" [value]="p._id">{{p.name}}</option>
            </select>

            <div class="text-danger small" *ngIf="prodRef.invalid && prodRef.touched">
                Product is required.
            </div>
        </div>
        <div class="col">
            <select class="form-select" [(ngModel)]="stage" name="stage" (change)="loadPlans()">
                <option value="in-process">In-Process</option>
                <option value="final">Final</option>
            </select>
        </div>

    </div>
    <div class="row mt-3">
        <div class="col">
            <select class="form-select" name="parameterId" [(ngModel)]="parameterId" required #paramRef="ngModel"
                [ngClass]="{'is-invalid': paramRef.invalid && paramRef.touched}">
                <option value="">Select Parameter</option>
                <option *ngFor="let p of parameters" [value]="p._id">{{p.name}}</option>
            </select>

            <div class="text-danger small" *ngIf="paramRef.invalid && paramRef.touched">
                Parameter is required.
            </div>
        </div>
        <div class="col">
            <input class="form-control" type="number" name="sampleSize" placeholder="Sample Size" required min="1"
                [(ngModel)]="sampleSize" #sampleRef="ngModel"
                [ngClass]="{'is-invalid': sampleRef.invalid && sampleRef.touched}">

            <div class="text-danger small" *ngIf="sampleRef.invalid && sampleRef.touched">
                Sample size must be at least 1.
            </div>
        </div>
        <div class="col">
            <input class="form-control" name="method" placeholder="Method" required minlength="2" [(ngModel)]="method"
                #methodRef="ngModel" [ngClass]="{'is-invalid': methodRef.invalid && methodRef.touched}">

            <div class="text-danger small" *ngIf="methodRef.invalid && methodRef.touched">
                Method is required (min 2 characters).
            </div>
        </div>
        <div class="col d-flex align-items-center">
            <label>
                <input type="checkbox" name="check" [(ngModel)]="check"> &nbsp; Check?
            </label>
        </div>
        <div class="col">
            <button class="btn btn-primary w-100" type="submit" [disabled]="planForm.invalid">
                Add
            </button>
        </div>
    </div>

</form>
<table class="table table-bordered mt-4">
    <thead>
        <tr>
            <th>Parameter</th>
            <th>Check</th>
            <th>Sample</th>
            <th>Method</th>
        </tr>
    </thead>
    <tbody>
        <tr *ngFor="let p of plans">
            <td>{{p.parameterId.name}}</td>
            <td>{{p.check ? 'Yes' : 'No'}}</td>
            <td>{{p.sampleSize}}</td>
            <td>{{p.method}}</td>
        </tr>
    </tbody>
</table>